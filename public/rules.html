<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Naming Game — Rules</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header>
      <h1>Set the Rules</h1>
      <p class="subtitle">Topic: <span id="topicLabel">—</span></p>
    </header>

    <section class="card">
      <div class="columns">
        <div>
          <h3>Mode</h3>
          <div class="row" style="gap:14px; flex-wrap: wrap;">
            <label><input type="radio" name="mode" value="solo" /> Solo</label>
            <label><input type="radio" name="mode" value="pvp" checked /> Multiplayer (Quick Match)</label>
            <label><input type="radio" name="mode" value="private" /> Private Room (Friends)</label>
          </div>

          <label style="margin-top:14px;">Seconds per answer</label>
          <input id="secondsInput" type="number" min="5" max="120" value="15" />

          <div id="quickMatchOptions">
            <label style="margin-top:14px;">Opponents (how many to face)</label>
            <input id="opponentsInput" type="number" min="1" max="7" value="3" />
          </div>

          <div id="privateOptions" class="hidden">
            <h3 style="margin-top:14px;">Private Room</h3>
            <div class="row" style="gap:14px;">
              <label><input type="radio" name="privRole" value="create" checked /> Create a room</label>
              <label><input type="radio" name="privRole" value="join" /> Join a room</label>
            </div>
            <label id="lblCode" class="hidden">Room code</label>
            <input id="roomCodeInput" type="text" maxlength="6" placeholder="ABC123" class="hidden" />
          </div>

          <div class="row" style="margin-top:14px;">
            <button id="start" class="primary">Continue →</button>
            <button id="backTopics" class="secondary">← Back</button>
          </div>
        </div>

        <div>
          <h3>How to play</h3>
          <p class="hint">
            No repeats. Inputs are accent-insensitive and include common aliases.
            <br/>Solo: each correct answer resets the timer; game ends when you run out of time.
            <br/>Quick Match: players are auto-matched by settings; timeout eliminates a player; winner decided at round ends.
            <br/>Private Room: share a 6‑letter code; host presses Start when ready; you can return to the lobby for rematches.
          </p>
        </div>
      </div>
    </section>
  </div>

  <script src="js/nav.js"></script>
  <script>
    NG.requireNameOrRedirect('index.html');
    NG.requireTopicOrRedirect('topics.html');

    const topicLabel = document.getElementById('topicLabel');
    topicLabel.textContent = NG.getTopicLabel();

    const secondsInput = document.getElementById('secondsInput');
    const opponentsInput = document.getElementById('opponentsInput');
    const start = document.getElementById('start');
    const backTopics = document.getElementById('backTopics');

    const quickMatchOptions = document.getElementById('quickMatchOptions');
    const privateOptions = document.getElementById('privateOptions');
    const roomCodeInput = document.getElementById('roomCodeInput');
    const lblCode = document.getElementById('lblCode');

    function mode() { return document.querySelector('input[name="mode"]:checked').value; }
    function privRole() { return document.querySelector('input[name="privRole"]:checked')?.value || 'create'; }

    function syncVisibility() {
      const m = mode();
      quickMatchOptions.classList.toggle('hidden', m !== 'pvp');
      privateOptions.classList.toggle('hidden', m !== 'private');
      const join = m === 'private' && privRole() === 'join';
      roomCodeInput.classList.toggle('hidden', !join);
      lblCode.classList.toggle('hidden', !join);
    }

    document.querySelectorAll('input[name="mode"]').forEach(r => r.addEventListener('change', syncVisibility));
    document.querySelectorAll('input[name="privRole"]').forEach(r => r.addEventListener('change', syncVisibility));
    syncVisibility();

    backTopics.addEventListener('click', () => history.back());
    start.addEventListener('click', () => {
      const m = mode();
      const perTurn = Number(secondsInput.value || 15);
      const opponents = Number(opponentsInput.value || 3);
      const role = privRole();
      const roomCode = (roomCodeInput.value || '').toUpperCase().trim();

      if (m === 'private' && role === 'join' && (!roomCode || roomCode.length < 4)) {
        alert('Please enter a valid room code.'); return;
      }

      NG.setRules({
        mode: m,
        perTurn,
        opponents,
        roomAction: (m === 'private') ? role : '',
        roomCode: (m === 'private' && role === 'join') ? roomCode : ''
      });

      location.href = 'play.html';
    });
  </script>
</body>
</html>
