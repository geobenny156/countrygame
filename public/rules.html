<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Naming Game â€” Rules</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .grid2 { display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 760px){ .grid2 { grid-template-columns: 1fr 1fr; } }
    .muted-small{ font-size:.9rem; opacity:.8; }
  </style>
</head>
<body>
  <div class="app">
    <header class="row" style="justify-content:space-between; align-items:flex-end;">
      <div>
        <h1>Set the Rules</h1>
        <p class="subtitle">Configure the match, then start playing.</p>
      </div>
      <!-- Accounts action (My Account or Sign In/Sign Up) -->
      <div id="accountActions" class="row" style="gap:8px;"></div>
    </header>

    <section class="card">
      <div class="grid2">
        <div>
          <label>Mode</label>
          <div class="row" style="gap:10px; flex-wrap:wrap;">
            <label><input type="radio" name="mode" value="solo"   checked> Solo</label>
            <label><input type="radio" name="mode" value="pvp"> Multiplayer (quick match)</label>
            <label><input type="radio" name="mode" value="private"> Private room</label>
          </div>

          <div id="opponentsRow" style="margin-top:8px;">
            <label>Number of opponents (for multiplayer)</label>
            <input id="opponents" type="number" min="1" max="7" value="1" />
          </div>

          <div id="privateWrap" class="hidden" style="margin-top:8px;">
            <label>Private room</label>
            <div class="row" style="gap:10px; flex-wrap:wrap;">
              <label><input type="radio" name="prv" value="create" checked> Create room</label>
              <label><input type="radio" name="prv" value="join"> Join room</label>
            </div>
            <div id="joinCodeRow" class="hidden" style="margin-top:8px;">
              <label>Enter room code</label>
              <input id="roomCode" type="text" placeholder="e.g., ABC123" maxlength="6" />
            </div>
            <p class="muted-small">Share the room code with friends to join.</p>
          </div>
        </div>

        <div>
          <label>Per-turn timer (seconds)</label>
          <input id="perTurn" type="number" min="5" max="120" value="15" />
          <p class="muted-small">Shorter timers make it harder to look things up.</p>

          <div class="row" style="gap:10px; margin-top:14px;">
            <button id="btnContinue" class="primary">Start</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script src="js/nav.js"></script>
  <script src="js/auth_overlay.js"></script>
  <script>
    NG.requireNameOrRedirect('account.html');
    NG.requireTopicOrRedirect('topics.html');

    const perTurn = document.getElementById('perTurn');
    const opponents = document.getElementById('opponents');
    const opponentsRow = document.getElementById('opponentsRow');
    const privateWrap = document.getElementById('privateWrap');
    const joinCodeRow = document.getElementById('joinCodeRow');
    const roomCode = document.getElementById('roomCode');
    const btnContinue = document.getElementById('btnContinue');

    const modeRadios = Array.from(document.querySelectorAll('input[name="mode"]'));
    const prvRadios  = () => Array.from(document.querySelectorAll('input[name="prv"]'));

    function updateVisibility() {
      const mode = (modeRadios.find(r => r.checked) || {}).value || 'solo';
      opponentsRow.classList.toggle('hidden', mode !== 'pvp');
      privateWrap.classList.toggle('hidden', mode !== 'private');
      joinCodeRow.classList.toggle('hidden', !(mode === 'private' && (prvRadios().find(r => r.checked)?.value === 'join')));
    }
    modeRadios.forEach(r => r.addEventListener('change', updateVisibility));
    document.querySelectorAll('input[name="prv"]').forEach(r => r.addEventListener('change', updateVisibility));
    updateVisibility();

    btnContinue.addEventListener('click', () => {
      const mode = (modeRadios.find(r => r.checked) || {}).value || 'solo';
      const secs = Math.max(5, Math.min(120, Number(perTurn.value || 15)));
      if (mode === 'solo') {
        NG.setRules({ mode:'solo', perTurn: secs });
        location.href = 'play.html';
      } else if (mode === 'pvp') {
        const opp = Math.max(1, Math.min(7, Number(opponents.value || 1)));
        NG.setRules({ mode:'pvp', perTurn: secs, opponents: opp });
        location.href = 'play.html';
      } else {
        const action = (prvRadios().find(r => r.checked) || {}).value || 'create';
        if (action === 'join') {
          const code = String(roomCode.value || '').toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,6);
          if (!code) { alert('Enter a room code to join.'); return; }
          NG.setRules({ mode:'private', perTurn: secs, roomAction:'join', roomCode: code });
        } else {
          NG.setRules({ mode:'private', perTurn: secs, roomAction:'create' });
        }
        location.href = 'play.html';
      }
    });
  </script>
</body>
</html>
